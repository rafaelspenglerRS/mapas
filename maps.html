<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RS em Dados</title>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        #mapContainer {
            height: 100vh;
            width: 100%;
            position: relative;
        }
        .filterPanel {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        .leaflet-top.leaflet-left {
            bottom: 10px !important;
            right: 10px !important;
            top: auto !important;
        }

		/* Removendo qualquer borda preta do pop-up */
		.leaflet-popup-content-wrapper, .leaflet-popup-tip {
            box-shadow: none !important;
            border: none !important;
        }
        
        /* Removendo o foco que cria o retângulo preto ao clicar */
        .leaflet-container:focus, .leaflet-interactive:focus {
            outline: none !important;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="relative">
        <div id="mapContainer"></div>
        <div class="filterPanel">
            <h2 class="text-lg font-bold mb-4">Filtros</h2>
            <div class="flex flex-col gap-4">
                <div class="flex items-center justify-between cursor-pointer border-b pb-2">
                    <h3 class="text-sm font-semibold">Divisões Territoriais</h3>
                </div>
                <div class="flex flex-col gap-2 pl-2">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="radio" name="regionType" id="regionsIntermediate" class="mr-2" /> Regiões Intermediárias
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="radio" name="regionType" id="regionsImmediate" class="mr-2" /> Regiões Imediatas
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="radio" name="regionType" id="regionsMunicipalities" class="mr-2" checked /> Municípios
                    </label>
                </div>
            </div>
        </div>
    </div>
    <script>
        var map = L.map('mapContainer').setView([-30.39183, -53.22876], 7);
        var osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);
        var geoJsonLayer;
        var selectedLayer = null;
        var regionFiles = {
            municipalities: 'https://raw.githubusercontent.com/rafaelspenglerRS/mapas/main/regioesGeograficasRS2017.geojson',
            intermediate: 'https://raw.githubusercontent.com/rafaelspenglerRS/mapas/main/regioesIntermediariasRS2017.geojson',
            immediate: 'https://raw.githubusercontent.com/rafaelspenglerRS/mapas/main/regioesImediatasRS2017.geojson'
        };
        var currentGeoJson = regionFiles.municipalities;
        function loadGeoJSON(geojsonFile, nameProperty) {
            if (geoJsonLayer) {
                map.removeLayer(geoJsonLayer);
            }
            fetch(geojsonFile)
                .then(response => response.json())
                .then(data => {
                    geoJsonLayer = L.geoJSON(data, {
                        style: () => ({ color: '#048042', weight: 1, fillOpacity: 0.7 }),
                        onEachFeature: function (feature, layer) {
                            let nome = feature.properties[nameProperty] || "Desconhecido";
                            layer.on({
                                mouseover: function (e) {
                                    e.target.setStyle({ color: '#fdc75f', weight: 3, fillOpacity: 0.8 });
                                    e.target.bindTooltip(nome, { permanent: false, direction: "top" }).openTooltip();
                                },
                                mouseout: function (e) {
                                    if (selectedLayer !== e.target) {
                                        e.target.setStyle({ color: '#048042', weight: 1, fillOpacity: 0.7 });
                                    }
                                },
                                click: function (e) {
                                    if (selectedLayer) {
                                        selectedLayer.setStyle({ color: '#048042', weight: 1, fillOpacity: 0.7 });
                                    }
                                    selectedLayer = e.target;
                                    e.target.setStyle({ color: '#ff0000', weight: 2, fillOpacity: 0.9 });
                                    let nomeFormatado = nome.toLowerCase().replace(/ /g, '-');
                                    let ibgeLink = `https://cidades.ibge.gov.br/brasil/rs/${nomeFormatado}/panorama`;
                                    L.popup({ closeButton: false, autoPan: true })
                                        .setLatLng(e.latlng)
                                        .setContent(`<b>${nome}</b><br><a href='${ibgeLink}' target='_blank'>Mais informações</a>`)
                                        .openOn(map);
                                }
                            });
                        }
                    }).addTo(map);
                });
        }
        loadGeoJSON(currentGeoJson, "NOME");
        document.getElementById('regionsIntermediate').addEventListener('change', function () {
            loadGeoJSON(regionFiles.intermediate, "nome_rgint");
        });
        document.getElementById('regionsImmediate').addEventListener('change', function () {
            loadGeoJSON(regionFiles.immediate, "nome_rgi");
        });
        document.getElementById('regionsMunicipalities').addEventListener('change', function () {
            loadGeoJSON(regionFiles.municipalities, "NOME");
        });
    </script>
</body>
</html>
